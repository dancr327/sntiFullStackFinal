<div class="app-container">
  <div class="main-content-wrapper">
    <div class="container mt-5">
      <div class="card shadow">
        <div class="card-header bg-light-blue text-white">
          <div class="d-flex justify-content-between align-items-center">
            <h3 class="mb-0">Mis Hijos</h3>
            <button class="btn btn-light-blue" data-bs-toggle="modal" data-bs-target="#hijoModal" (click)="prepararNuevoHijo()">
              <i class="bi bi-plus-circle me-2"></i>Registrar Hijo
            </button>
          </div>
        </div>
        <div class="card-body">
          <div class="table-responsive">
            <table class="table table-hover">
              <thead class="bg-light-blue text-white">
                <tr>
                  <th>Nombre</th>
                  <th>Fecha Nacimiento</th>
                  <th>Vigente</th>
                  <th>Acciones</th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let h of hijos">
                  <td>{{ h.nombre }} {{ h.apellido_paterno }} {{ h.apellido_materno }}</td>
                  <td>{{ h.fecha_nacimiento | date:'dd/MM/yyyy' }}</td>
                  <td>
                    <span class="badge" [ngClass]="{ 'bg-success': h.vigente, 'bg-secondary': !h.vigente }">
                      {{ h.vigente ? 'Vigente' : 'No vigente' }}
                    </span>
                  </td>
                  <td>
                    <div class="d-flex">
                      <button class="btn btn-light-blue me-2" (click)="verDetalles(h)" data-bs-toggle="modal" data-bs-target="#detalleModal">
                        <span class="material-icons">visibility</span>
                      </button>
                      <button class="btn btn-warning me-2" (click)="editar(h)" data-bs-toggle="modal" data-bs-target="#hijoModal">
                        <span class="material-icons">edit</span>
                      </button>
                      <button class="btn btn-danger" (click)="eliminar(h.id_hijo)">
                        <span class="material-icons">delete</span>
                      </button>
                    </div>
                  </td>
                </tr>
                <tr *ngIf="hijos.length === 0">
                  <td colspan="4" class="text-center">No tienes hijos registrados</td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Modal formulario -->
<div class="modal fade" id="hijoModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header bg-light-blue text-white">
        <h5 class="modal-title">{{ editando ? 'Editar Hijo' : 'Registrar Hijo' }}</h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        <form (ngSubmit)="guardarHijo()" #hijoForm="ngForm">
          <div class="mb-3">
            <label class="form-label">Nombre</label>
            <input type="text" class="form-control" [(ngModel)]="nuevoHijo.nombre" name="nombre" required />
          </div>
          <div class="mb-3">
            <label class="form-label">Apellido Paterno</label>
            <input type="text" class="form-control" [(ngModel)]="nuevoHijo.apellido_paterno" name="apellido_paterno" required />
          </div>
          <div class="mb-3">
            <label class="form-label">Apellido Materno</label>
            <input type="text" class="form-control" [(ngModel)]="nuevoHijo.apellido_materno" name="apellido_materno" required />
          </div>
          <div class="mb-3">
            <label class="form-label">Fecha de nacimiento</label>
            <input type="date" class="form-control" [(ngModel)]="nuevoHijo.fecha_nacimiento" name="fecha_nacimiento" required />
          </div>
          <div class="mb-3">
            <label class="form-label">Acta de nacimiento</label>
            <input type="file" class="form-control" (change)="onFileSelected($event)" accept=".pdf,.doc,.docx" />
            <small class="text-muted" *ngIf="editando">Deja vac√≠o si no deseas cambiar el acta.</small>
          </div>
          <div class="d-flex justify-content-end">
            <button type="button" class="btn btn-secondary me-2" data-bs-dismiss="modal">Cancelar</button>
            <button type="submit" class="btn btn-light-blue" [disabled]="!hijoForm.form.valid">{{ editando ? 'Actualizar' : 'Guardar' }}</button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>

<!-- Modal detalle -->
<div class="modal fade" id="detalleModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header bg-light-blue text-white">
        <h5 class="modal-title">Detalle del Hijo</h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body" *ngIf="hijoSeleccionado">
        <div class="mb-3">
          <h6>Nombre:</h6>
          <p>{{ hijoSeleccionado.nombre }} {{ hijoSeleccionado.apellido_paterno }} {{ hijoSeleccionado.apellido_materno }}</p>
        </div>
        <div class="mb-3">
          <h6>Fecha de nacimiento:</h6>
          <p>{{ hijoSeleccionado.fecha_nacimiento | date:'dd/MM/yyyy' }}</p>
        </div>
        <div class="mb-3">
          <h6>Acta:</h6>
          <ng-container *ngIf="hijoSeleccionado.documentos">
            <a (click)="descargarActa(hijoSeleccionado)" class="btn btn-light-blue btn-sm">
              <i class="bi bi-download me-2"></i>{{ hijoSeleccionado.documentos.nombre_archivo || 'Descargar' }}
            </a>
          </ng-container>
          <span *ngIf="!hijoSeleccionado.documentos" class="text-muted">No hay documento</span>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-light-blue" data-bs-dismiss="modal">Cerrar</button>
      </div>
    </div>
  </div>
</div>